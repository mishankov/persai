<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>NBA Games</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<script src="https://cdn.tailwindcss.com/3.4.0"></script>
		<link
			href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css"
			rel="stylesheet"
			type="text/css"
		/>
		<style>
			.loading-spinner {
				@apply animate-spin rounded-full border-2 border-gray-300 border-t-blue-600;
			}
		</style>
	</head>
	<body>
		<div id="app">
			<!-- Loading state -->
			<div id="loading" class="flex justify-center p-4">
				<span class="h-6 w-6 loading-spinner"></span>
			</div>

			<!-- Error state -->
			<div id="error" class="hidden p-2 text-sm text-red-600"></div>

			<!-- No games state -->
			<div id="no-games" class="hidden p-2 text-sm text-gray-600">No NBA games available</div>

			<!-- Widget Layout -->
			<div id="widget-layout" class="hidden p-2">
				<div id="widget-games" class="space-y-2"></div>
			</div>

			<!-- Fullscreen Layout -->
			<div id="fullscreen-layout" class="container mx-auto hidden p-4">
				<h1 class="mb-6 text-3xl font-bold">NBA Games</h1>
				<div id="fullscreen-games" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
			</div>
		</div>

		<script>
			let games = [];
			let loading = true;
			let error = null;

			const urlParams = new URLSearchParams(window.location.search);
			const target = urlParams.get('target') || 'widget';
			const isWidget = target === 'widget';
			const isFullscreen = target === 'fullscreen';

			function formatGameTime(dateStr) {
				return new Date(dateStr).toLocaleString('en-US', {
					month: 'short',
					day: 'numeric',
					hour: '2-digit',
					minute: '2-digit'
				});
			}

			function getScoreDisplay(game) {
				const competition = game.competitions[0];
				const homeTeam = competition.competitors.find((c) => c.homeAway === 'home');
				const awayTeam = competition.competitors.find((c) => c.homeAway === 'away');

				return {
					home: {
						name: homeTeam.team.displayName,
						score: homeTeam.score,
						logo: homeTeam.team.logo,
						records: homeTeam.records
					},
					away: {
						name: awayTeam.team.displayName,
						score: awayTeam.score,
						logo: awayTeam.team.logo,
						records: awayTeam.records
					},
					status: competition.status.type.description,
					clock: competition.status.displayClock,
					period: competition.status.period,
					detail: competition.status.type.detail
				};
			}

			function createWidgetGameCard(gameData, game) {
				const clockBadge =
					gameData.clock && gameData.period > 0
						? `<span class="badge badge-xs badge-info">Q${gameData.period} ${gameData.clock}</span>`
						: '';

				return `
                <div class="rounded-lg bg-base-200 p-2">
                    <div class="mb-1 flex items-center justify-between">
                        <span class="text-xs font-medium">${gameData.status}</span>
                        ${clockBadge}
                    </div>
                    <div class="space-y-1">
                        <!-- Away Team -->
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-1">
                                <img src="${gameData.away.logo}" alt="${gameData.away.name}" class="h-4 w-4 rounded" />
                                <span class="text-xs">${gameData.away.name}</span>
                            </div>
                            <span class="text-sm font-bold">${gameData.away.score}</span>
                        </div>
                        <!-- Home Team -->
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-1">
                                <img src="${gameData.home.logo}" alt="${gameData.home.name}" class="h-4 w-4 rounded" />
                                <span class="text-xs">${gameData.home.name}</span>
                            </div>
                            <span class="text-sm font-bold">${gameData.home.score}</span>
                        </div>
                    </div>
                    <div class="mt-1 text-xs text-base-content/50">
                        ${gameData.detail || formatGameTime(game.date)}
                    </div>
                </div>
            `;
			}

			function createFullscreenGameCard(gameData, game) {
				const clockBadge =
					gameData.clock && gameData.period > 0
						? `<div class="badge badge-info">Q${gameData.period} ${gameData.clock}</div>`
						: '';

				const awayRecord = gameData.away.records
					? `<div class="text-xs text-base-content/60">${gameData.away.records.find((r) => r.type === 'total')?.summary}</div>`
					: '';

				const homeRecord = gameData.home.records
					? `<div class="text-xs text-base-content/60">${gameData.home.records.find((r) => r.type === 'total')?.summary}</div>`
					: '';

				return `
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <div class="mb-4 flex items-center justify-between">
                            <h2 class="card-title text-lg">${gameData.status}</h2>
                            ${clockBadge}
                        </div>
                        <div class="space-y-3">
                            <!-- Away Team -->
                            <div class="flex items-center justify-between rounded-lg bg-base-200 p-3">
                                <div class="flex items-center space-x-3">
                                    <img src="${gameData.away.logo}" alt="${gameData.away.name}" class="h-8 w-8 rounded" />
                                    <div>
                                        <span class="font-medium">${gameData.away.name}</span>
                                        ${awayRecord}
                                    </div>
                                </div>
                                <span class="text-2xl font-bold">${gameData.away.score}</span>
                            </div>
                            <!-- Home Team -->
                            <div class="flex items-center justify-between rounded-lg bg-base-200 p-3">
                                <div class="flex items-center space-x-3">
                                    <img src="${gameData.home.logo}" alt="${gameData.home.name}" class="h-8 w-8 rounded" />
                                    <div>
                                        <span class="font-medium">${gameData.home.name}</span>
                                        ${homeRecord}
                                    </div>
                                </div>
                                <span class="text-2xl font-bold">${gameData.home.score}</span>
                            </div>
                        </div>
                        <div class="mt-4 card-actions justify-end">
                            <div class="text-xs text-base-content/60">
                                ${gameData.detail || formatGameTime(game.date)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
			}

			function renderWidgetLayout() {
				const widgetContainer = document.getElementById('widget-games');
				widgetContainer.innerHTML = games
					.map((game) => {
						const gameData = getScoreDisplay(game);
						return createWidgetGameCard(gameData, game);
					})
					.join('');
			}

			function renderFullscreenLayout() {
				const fullscreenContainer = document.getElementById('fullscreen-games');
				fullscreenContainer.innerHTML = games
					.map((game) => {
						const gameData = getScoreDisplay(game);
						return createFullscreenGameCard(gameData, game);
					})
					.join('');
			}

			function render() {
				const loadingEl = document.getElementById('loading');
				const errorEl = document.getElementById('error');
				const noGamesEl = document.getElementById('no-games');
				const widgetLayoutEl = document.getElementById('widget-layout');
				const fullscreenLayoutEl = document.getElementById('fullscreen-layout');

				// Hide all elements first
				loadingEl.classList.add('hidden');
				errorEl.classList.add('hidden');
				noGamesEl.classList.add('hidden');
				widgetLayoutEl.classList.add('hidden');
				fullscreenLayoutEl.classList.add('hidden');

				if (error) {
					errorEl.classList.remove('hidden');
					errorEl.textContent = error;
				} else if (games.length === 0) {
					noGamesEl.classList.remove('hidden');
				} else {
					if (isWidget) {
						widgetLayoutEl.classList.remove('hidden');
						renderWidgetLayout();
					} else {
						fullscreenLayoutEl.classList.remove('hidden');
						renderFullscreenLayout();
					}
				}
			}

			async function loadGames() {
				try {
					const response = await fetch(
						'https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard'
					);
					const data = await response.json();
					games = data.events || [];
				} catch (err) {
					error = 'Failed to load NBA games';
					console.error(err);
				} finally {
					loading = false;
					render();
				}
			}

			// Initialize
			document.addEventListener('DOMContentLoaded', () => {
				loadGames();
			});
		</script>
	</body>
</html>
